<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>성향 기반 직무 추천</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; padding: 20px; }
    h1, h2 { text-align: center; }
    button { padding: 10px 20px; margin: 10px; }
    .tag { font-size: 0.9em; color: #666; }
  </style>
</head>
<body>
  <h1>성향 기반 직무 추천</h1>
  <div id="start-screen">
    <p>몇 가지 질문에 답하면 당신의 성향에 맞는 직무를 추천해드립니다.</p>
    <button onclick="startQuiz()">지금 시작하기</button>
  </div>

  <div id="quiz-screen" style="display:none;">
    <p id="question"></p>
    <button onclick="answer(1)">그렇다</button>
    <button onclick="answer(0)">아니다</button>
  </div>

  <div id="result-screen" style="display:none;">
    <h2 style="margin:6px 0 8px;">추천 직무 Top 10</h2>
    <ol id="job-top"></ol>
    <button onclick="restart()">다시 하기</button>
  </div>

  <!-- 기본판 직무 데이터 -->
  <script src="jobs_from_excel.js"></script>
  <script>
    const JOBS = (typeof JOBS_FROM_EXCEL !== 'undefined' ? JOBS_FROM_EXCEL : []);

    // 간단 질문 (30개 예시)
    const questions = [
      "새로운 아이디어를 떠올리는 것을 즐긴다.",
      "데이터를 분석하는 것을 좋아한다.",
      "다른 사람을 돕는 일에 보람을 느낀다.",
      "계획을 세우고 실행하는 데 강점이 있다.",
      "감각적인 디자인에 관심이 많다.",
      "수치를 기반으로 판단하는 편이다.",
      "팀워크가 중요한 환경을 선호한다.",
      "위기 상황에서 빠르게 결단한다.",
      "새로운 기술을 배우는 것이 즐겁다.",
      "문제를 창의적으로 해결한다.",
      "사람들의 의견을 경청한다.",
      "실행 계획을 철저히 지킨다.",
      "시장 동향을 분석한다.",
      "서비스 품질 향상에 관심 있다.",
      "위험을 감수하는 편이다.",
      "규칙과 절차를 존중한다.",
      "비즈니스 전략을 세운다.",
      "고객과의 관계를 중시한다.",
      "효율적인 업무 방식을 찾는다.",
      "세부 사항을 꼼꼼히 확인한다.",
      "다양한 문화에 관심 있다.",
      "새로운 방식을 시도한다.",
      "데이터 시각화를 즐긴다.",
      "변화에 잘 적응한다.",
      "목표 달성을 위해 노력한다.",
      "감정 이입을 잘한다.",
      "리더십을 발휘한다.",
      "성과를 측정한다.",
      "창의적인 글을 쓴다.",
      "기술 문제를 해결한다."
    ];

    let current = 0;
    let scores = { A: 0, C: 0, S: 0, P: 0 };

    function startQuiz() {
      document.getElementById("start-screen").style.display = "none";
      document.getElementById("quiz-screen").style.display = "block";
      showQuestion();
    }

    function showQuestion() {
      document.getElementById("question").textContent = questions[current];
    }

    function answer(val) {
      // 간단 매핑 (순서대로 A/C/S/P)
      const traits = ["A","C","S","P"];
      const trait = traits[current % 4];
      scores[trait] += val;
      current++;
      if (current < questions.length) {
        showQuestion();
      } else {
        showResult();
      }
    }

    function suitability(w) {
      // 가중치와 점수를 기반으로 적합도 계산
      const totalQuestionsPerTrait = questions.length / 4;
      let sum = 0;
      sum += (scores.A / totalQuestionsPerTrait) * w.A;
      sum += (scores.C / totalQuestionsPerTrait) * w.C;
      sum += (scores.S / totalQuestionsPerTrait) * w.S;
      sum += (scores.P / totalQuestionsPerTrait) * w.P;
      return Math.round(sum * 100);
    }

    function jobFamily(title) {
      let t = (title || '').trim();
      t = t.split('–')[0].split('-')[0].trim();
      t = t.replace(/\s*\(.*?\)\s*/g, '').trim();
      t = t.replace(/\s{2,}/g, ' ');
      return t;
    }

    function showResult() {
      document.getElementById("quiz-screen").style.display = "none";
      document.getElementById("result-screen").style.display = "block";

      // 전체 직무를 적합도 순으로 정렬
      const rankedAll = JOBS
        .map(j => ({ ...j, score: suitability(j.w) }))
        .sort((a, b) => b.score - a.score);

      // 동일 직무군 최대 2개, 총 10개 제한
      let ranked = [];
      const famCount = {};
      for (const j of rankedAll) {
        const fam = jobFamily(j.title);
        const c = famCount[fam] || 0;
        if (c >= 2) continue;
        ranked.push(j);
        famCount[fam] = c + 1;
        if (ranked.length >= 10) break;
      }

      // 화면 렌더링
      const list = document.getElementById('job-top');
      list.innerHTML = '';
      ranked.forEach(j => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${j.title}</strong> — ${j.explain} <span class="tag">적합도 ${j.score}%</span>`;
        list.appendChild(li);
      });
    }

    function restart() {
      current = 0;
      scores = { A: 0, C: 0, S: 0, P: 0 };
      document.getElementById("result-screen").style.display = "none";
      document.getElementById("start-screen").style.display = "block";
    }
  </script>
</body>
</html>
